name: main

on:
  workflow_dispatch:
    inputs:
      package:
        description: 'The package to build'
        required: true
      build_only:
        description: 'Skip deployment (if non-empty)'
        required: false

env:
  PACKAGE_TO_BUILD: "${{github.event.inputs.package}}"
  BUILD_ONLY: "${{github.event.inputs.build_only}}"
  GPG_OPTIONS: "--batch --yes --no-tty --list-options no-show-photos --verify-options no-show-photos --pinentry-mode loopback"

jobs:
  build-and-deploy:
    runs-on: windows-latest
    steps:
      - name: Mount MSYS on A:/
        run: |
          subst A: C:\msys64
      - name: Export PATH
        run: |
          [Environment]::SetEnvironmentVariable("Path", "A:\usr\bin;"+$env:Path, "Machine")
        
      - name: Test PATH
        shell: cmd
        run: ls /d
        
      - name: Test shell arguments
        shell: bash {0}
        run: |
          pacman -Syu
          
      - name: Hello
        run: |
          A:/usr/bin/bash -lc "echo Hello world"
